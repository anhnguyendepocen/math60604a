<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.3 Wilcoxon rank sum test | Statistical Modelling</title>
  <meta name="description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="2.3 Wilcoxon rank sum test | Statistical Modelling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  <meta name="github-repo" content="lbelzile/math60604a" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.3 Wilcoxon rank sum test | Statistical Modelling" />
  
  <meta name="twitter:description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  

<meta name="author" content="Léo Belzile" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="two-sample-t-test.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical-modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preliminary remarks</a><ul>
<li class="chapter" data-level="0.1" data-path="basics-of-r.html"><a href="basics-of-r.html"><i class="fa fa-check"></i><b>0.1</b> Basics of <strong>R</strong></a><ul>
<li class="chapter" data-level="0.1.1" data-path="basics-of-r.html"><a href="basics-of-r.html#help"><i class="fa fa-check"></i><b>0.1.1</b> Help</a></li>
<li class="chapter" data-level="0.1.2" data-path="basics-of-r.html"><a href="basics-of-r.html#basic-commands"><i class="fa fa-check"></i><b>0.1.2</b> Basic commands</a></li>
<li class="chapter" data-level="0.1.3" data-path="basics-of-r.html"><a href="basics-of-r.html#linear-algebra-in-r"><i class="fa fa-check"></i><b>0.1.3</b> Linear algebra in <strong>R</strong></a></li>
<li class="chapter" data-level="0.1.4" data-path="basics-of-r.html"><a href="basics-of-r.html#packages"><i class="fa fa-check"></i><b>0.1.4</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="week1.html"><a href="week1.html"><i class="fa fa-check"></i><b>0.2</b> Tutorial 1</a><ul>
<li class="chapter" data-level="0.2.1" data-path="week1.html"><a href="week1.html#datasets"><i class="fa fa-check"></i><b>0.2.1</b> Datasets</a></li>
<li class="chapter" data-level="0.2.2" data-path="week1.html"><a href="week1.html#graphics"><i class="fa fa-check"></i><b>0.2.2</b> Graphics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="statistical-inference-versus-predictions.html"><a href="statistical-inference-versus-predictions.html"><i class="fa fa-check"></i><b>1.1</b> Statistical inference versus predictions</a></li>
<li class="chapter" data-level="1.2" data-path="reminders-and-objectives.html"><a href="reminders-and-objectives.html"><i class="fa fa-check"></i><b>1.2</b> Reminders and Objectives</a></li>
<li class="chapter" data-level="1.3" data-path="population-and-sample.html"><a href="population-and-sample.html"><i class="fa fa-check"></i><b>1.3</b> Population and sample</a></li>
<li class="chapter" data-level="1.4" data-path="testing-statistical-hypotheses.html"><a href="testing-statistical-hypotheses.html"><i class="fa fa-check"></i><b>1.4</b> Testing statistical hypotheses</a></li>
<li class="chapter" data-level="1.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>1.5</b> Exploratory data analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="one-sample-and-two-sample-location-tests.html"><a href="one-sample-and-two-sample-location-tests.html"><i class="fa fa-check"></i><b>2</b> One-sample and two-sample location tests</a><ul>
<li class="chapter" data-level="2.1" data-path="one-sample-and-paired-t-test.html"><a href="one-sample-and-paired-t-test.html"><i class="fa fa-check"></i><b>2.1</b> One-sample and paired <em>t</em>-test</a></li>
<li class="chapter" data-level="2.2" data-path="two-sample-t-test.html"><a href="two-sample-t-test.html"><i class="fa fa-check"></i><b>2.2</b> Two-sample <em>t</em>-test</a></li>
<li class="chapter" data-level="2.3" data-path="wilcoxon-rank-sum-test.html"><a href="wilcoxon-rank-sum-test.html"><i class="fa fa-check"></i><b>2.3</b> Wilcoxon rank sum test</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>3</b> Linear regression</a><ul>
<li class="chapter" data-level="3.1" data-path="the-lm-function.html"><a href="the-lm-function.html"><i class="fa fa-check"></i><b>3.1</b> The <code>lm</code> function</a><ul>
<li class="chapter" data-level="3.1.1" data-path="the-lm-function.html"><a href="the-lm-function.html#graphical-diagnostics-and-analysis-of-residuals"><i class="fa fa-check"></i><b>3.1.1</b> Graphical diagnostics and analysis of residuals</a></li>
<li class="chapter" data-level="3.1.2" data-path="the-lm-function.html"><a href="the-lm-function.html#binary-explanatory-variable"><i class="fa fa-check"></i><b>3.1.2</b> Binary explanatory variable</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wilcoxon-rank-sum-test" class="section level2">
<h2><span class="header-section-number">2.3</span> Wilcoxon rank sum test</h2>
<p>If the data are not normal, either because the distribution is skewed or heavy-tailed, or because the sample sizes are small enough that the asymptotic distribution of the Welch test or the two-sample <span class="math inline">\(t\)</span>-test is unreliable, we may resort to non-parametric procedures. The Wilcoxon rank-sum test is a test for a shift in distribution; the drawback is that it requires the distribution of the samples to be the same, up to a change in location. If the mean is finite, then this amounts to a change in mean under the assumption that <span class="math inline">\(F_1(x-\Delta)=F_0(x)\)</span> for any <span class="math inline">\(x\)</span> for <span class="math inline">\(F_0, F_1\)</span> the distribution function in group 0 and 1, respectively.</p>
<p>The syntax for the test is analogous to that of the other using the formula <code>y ~ x</code>, namely <code>wilcox.test(offer ~ groupe, data = tickets)</code>. You can also specify the values for the two samples with the arguments <code>x</code> and <code>y</code>.
The Wilcoxon rank sum test works with ranks, which is the relative position of the observations in the pooled sample. Intuitively, if there is no difference and both samples come from the same distribution <span class="math inline">\(F_0(x)\)</span>, the sum of the ranks in either group (relative to the number of observations in that group) should not be systematically too large or too small. Because ranks are bounded by <span class="math inline">\(n\)</span>, the test statistic is less sensitive to outliers or extremes, even if its power is not as great in small samples, the loss of power is often not meaningful and the robustness is appealing, which is why Wilcoxon rank sum test is widely used in practice. Since ranks are discrete, the distribution of the sum is tractable and we can use combinatorics to list all possibilities. For example, with eight observations split in two subgroups of equal size, the null distribution is</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
10
</th>
<th style="text-align:right;">
11
</th>
<th style="text-align:right;">
12
</th>
<th style="text-align:right;">
13
</th>
<th style="text-align:right;">
14
</th>
<th style="text-align:right;">
15
</th>
<th style="text-align:right;">
16
</th>
<th style="text-align:right;">
17
</th>
<th style="text-align:right;">
18
</th>
<th style="text-align:right;">
19
</th>
<th style="text-align:right;">
20
</th>
<th style="text-align:right;">
21
</th>
<th style="text-align:right;">
22
</th>
<th style="text-align:right;">
23
</th>
<th style="text-align:right;">
24
</th>
<th style="text-align:right;">
25
</th>
<th style="text-align:right;">
26
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Probability (%)
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
7.1
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
1.4
</td>
</tr>
</tbody>
</table>
<p>Note that the value returned by <strong>R</strong> for the Wilcoxon rank sum test is not the same as the formula covered in class; it subtracts the minimum possible rank sum, here <span class="math inline">\(m(m+1)/2\)</span> for a first sample of size <span class="math inline">\(m\)</span> so that the statistic is bounded below by zero, regardless of the sample size. As this is a shift by a deterministic constant, it has no impact on the asymptotic distribution.</p>
<p>In practice, there will often be ties (when two values are identical) and this means that the ranks are not uniquely defined (we could assign ranks at random for ties, or take the average, etc.); <strong>R</strong> will print a warning message to notify the user of the presence of ties. Formulae are adapted to deal with ties, but the software computes these automatically for us. While you will see multiple online references to the function <code>wilcox.test</code>, it does not return the correct <span class="math inline">\(p\)</span>-value, point estimate or confidence interval as soon as there are ties — it is unfortunately is not doing the right thing. Outside of small samples, tabulating the null distribution is prohibitive if there are more than 50 observations in total, since the total number of possibilities explodes. In class, we saw that a normal approximation for the null distribution, i.e., the distribution of the rank sum test under the assumption that the two samples, of size <span class="math inline">\(n_1\)</span> and <span class="math inline">\(n-n_1=n_2\)</span>, respectively, both have distribution function <span class="math inline">\(F\)</span>. The distribution can easily be approximated by simulation, by sampling uniformly integer values from 1 to <span class="math inline">\(n\)</span> and summing the first <span class="math inline">\(n_1\)</span>. We can repeat this a large number of times and get a good approximation. If there are ties, we proceed accordingly by resampling <span class="math inline">\(n_1\)</span> of the <span class="math inline">\(n\)</span> ranks, without replacement. The normal approximation, whose formula was given in the slides, matches quite closely the empirical distribution of the simulated values; this is a consequence of the central limit theorem. Because of the normal approximation, we can do two-sided tests exactly as before by defining exteme values as deviation from the mean either side.</p>
<p>We illustrate this concept with the <code>tickets</code> data; bear in mind that the test is not valid here, because the data clearly do not come from the same distribution up to a shift (in particular, the variance are clearly not the same). We would normally need to test formally for equality of distribution up to a location shift, but this requires yet another test; most of the time, we will assess this hypothesis graphically.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="wilcoxon-rank-sum-test.html#cb34-1"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(tickets)</span>
<span id="cb34-2"><a href="wilcoxon-rank-sum-test.html#cb34-2"></a><span class="co"># correct p-value, wrong confint and pe</span></span>
<span id="cb34-3"><a href="wilcoxon-rank-sum-test.html#cb34-3"></a>exactRankTests<span class="op">::</span><span class="kw">wilcox.exact</span>(offer <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> tickets, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Exact Wilcoxon rank sum test
## 
## data:  offer by group
## W = 288, p-value = 0.002
## alternative hypothesis: true mu is not equal to 0
## 95 percent confidence interval:
##  -22  -4
## sample estimates:
## difference in location 
##                    -13</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="wilcoxon-rank-sum-test.html#cb36-1"></a><span class="co"># wrong p-value b/c of ties, correct confint and pe</span></span>
<span id="cb36-2"><a href="wilcoxon-rank-sum-test.html#cb36-2"></a><span class="kw">wilcox.test</span>(offer <span class="op">~</span><span class="st"> </span>group, <span class="dt">data =</span> tickets, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  offer by group
## W = 288, p-value = 0.003
## alternative hypothesis: true location shift is not equal to 0
## 95 percent confidence interval:
##  -20  -4
## sample estimates:
## difference in location 
##                    -12</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="wilcoxon-rank-sum-test.html#cb38-1"></a><span class="co"># Test statistic is sum of ranks</span></span>
<span id="cb38-2"><a href="wilcoxon-rank-sum-test.html#cb38-2"></a>Wteststat &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">rank</span>(tickets<span class="op">$</span>offer, </span>
<span id="cb38-3"><a href="wilcoxon-rank-sum-test.html#cb38-3"></a>                      <span class="dt">ties.method =</span> <span class="st">&quot;average&quot;</span>)[tickets<span class="op">$</span>group <span class="op">==</span><span class="st"> &quot;cash&quot;</span>])</span>
<span id="cb38-4"><a href="wilcoxon-rank-sum-test.html#cb38-4"></a>         </span>
<span id="cb38-5"><a href="wilcoxon-rank-sum-test.html#cb38-5"></a><span class="co"># Compute the p-value through simulation</span></span>
<span id="cb38-6"><a href="wilcoxon-rank-sum-test.html#cb38-6"></a>prank &lt;-<span class="st"> </span><span class="kw">rank</span>(tickets<span class="op">$</span>offer, </span>
<span id="cb38-7"><a href="wilcoxon-rank-sum-test.html#cb38-7"></a>             <span class="dt">ties.method =</span> <span class="st">&quot;average&quot;</span>)</span>
<span id="cb38-8"><a href="wilcoxon-rank-sum-test.html#cb38-8"></a>nrep &lt;-<span class="st"> </span><span class="fl">1e6</span>L</span>
<span id="cb38-9"><a href="wilcoxon-rank-sum-test.html#cb38-9"></a>W &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nrep)</span>
<span id="cb38-10"><a href="wilcoxon-rank-sum-test.html#cb38-10"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nrep){</span>
<span id="cb38-11"><a href="wilcoxon-rank-sum-test.html#cb38-11"></a>   <span class="co">#resample the ranks</span></span>
<span id="cb38-12"><a href="wilcoxon-rank-sum-test.html#cb38-12"></a>   x &lt;-<span class="st"> </span><span class="kw">sample</span>(prank, <span class="dt">size =</span> <span class="dv">33</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</span>
<span id="cb38-13"><a href="wilcoxon-rank-sum-test.html#cb38-13"></a>   W[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(x)</span>
<span id="cb38-14"><a href="wilcoxon-rank-sum-test.html#cb38-14"></a>}</span>
<span id="cb38-15"><a href="wilcoxon-rank-sum-test.html#cb38-15"></a>n1 &lt;-<span class="st"> </span><span class="dv">33</span>; </span>
<span id="cb38-16"><a href="wilcoxon-rank-sum-test.html#cb38-16"></a>n2 &lt;-<span class="st"> </span><span class="dv">31</span></span>
<span id="cb38-17"><a href="wilcoxon-rank-sum-test.html#cb38-17"></a></span>
<span id="cb38-18"><a href="wilcoxon-rank-sum-test.html#cb38-18"></a><span class="kw">hist</span>(W, <span class="dt">freq =</span> <span class="ot">FALSE</span>, </span>
<span id="cb38-19"><a href="wilcoxon-rank-sum-test.html#cb38-19"></a>     <span class="dt">ylab =</span> <span class="st">&quot;density&quot;</span>, </span>
<span id="cb38-20"><a href="wilcoxon-rank-sum-test.html#cb38-20"></a>     <span class="dt">xlab =</span> <span class="st">&quot;simulated $W$&quot;</span>, </span>
<span id="cb38-21"><a href="wilcoxon-rank-sum-test.html#cb38-21"></a>     <span class="dt">main =</span> <span class="st">&quot;&quot;</span>) <span class="co">#remove title</span></span>
<span id="cb38-22"><a href="wilcoxon-rank-sum-test.html#cb38-22"></a><span class="kw">abline</span>(<span class="dt">v =</span> Wteststat, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)<span class="co"># add line for test stat</span></span>
<span id="cb38-23"><a href="wilcoxon-rank-sum-test.html#cb38-23"></a></span>
<span id="cb38-24"><a href="wilcoxon-rank-sum-test.html#cb38-24"></a><span class="co"># Warning: this normal approximation is for</span></span>
<span id="cb38-25"><a href="wilcoxon-rank-sum-test.html#cb38-25"></a><span class="co"># data w/o ties, i.e., the formula presented</span></span>
<span id="cb38-26"><a href="wilcoxon-rank-sum-test.html#cb38-26"></a><span class="co"># in the course slides </span></span>
<span id="cb38-27"><a href="wilcoxon-rank-sum-test.html#cb38-27"></a>mues &lt;-<span class="st"> </span>n1<span class="op">*</span>(n1<span class="op">+</span>n2<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span> <span class="co">#mean of normal approx</span></span>
<span id="cb38-28"><a href="wilcoxon-rank-sum-test.html#cb38-28"></a>sdes &lt;-<span class="st"> </span><span class="kw">sqrt</span>(n1<span class="op">*</span>n2<span class="op">*</span>(n1<span class="op">+</span>n2<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">12</span>) <span class="co">#var of normal approx</span></span>
<span id="cb38-29"><a href="wilcoxon-rank-sum-test.html#cb38-29"></a><span class="co">#superimpose normal approx to empirical distribution</span></span>
<span id="cb38-30"><a href="wilcoxon-rank-sum-test.html#cb38-30"></a><span class="kw">lines</span>(<span class="kw">seq</span>(<span class="dv">700</span>, <span class="dv">1600</span>, <span class="dt">length =</span> 1000L),</span>
<span id="cb38-31"><a href="wilcoxon-rank-sum-test.html#cb38-31"></a><span class="kw">dnorm</span>(x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">700</span>, <span class="dv">1600</span>, <span class="dt">length =</span> 1000L),</span>
<span id="cb38-32"><a href="wilcoxon-rank-sum-test.html#cb38-32"></a>      <span class="dt">mean =</span> mues, <span class="dt">sd =</span> sdes), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="Statistical-modelling_files/figure-html/wilcoxsimu-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="wilcoxon-rank-sum-test.html#cb39-1"></a><span class="co"># Simulated one-sided p-value</span></span>
<span id="cb39-2"><a href="wilcoxon-rank-sum-test.html#cb39-2"></a><span class="co"># by defn, proportion of samples as extreme (i.e. smaller)</span></span>
<span id="cb39-3"><a href="wilcoxon-rank-sum-test.html#cb39-3"></a><span class="kw">mean</span>(W <span class="op">&lt;</span><span class="st"> </span>Wteststat)</span></code></pre></div>
<pre><code>## [1] 0.0011</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="wilcoxon-rank-sum-test.html#cb41-1"></a><span class="co">#p-value from normal approx</span></span>
<span id="cb41-2"><a href="wilcoxon-rank-sum-test.html#cb41-2"></a><span class="kw">pnorm</span>(<span class="dt">q =</span> Wteststat, <span class="dt">mean =</span> mues, <span class="dt">sd =</span> sdes)</span></code></pre></div>
<pre><code>## [1] 0.0014</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="wilcoxon-rank-sum-test.html#cb43-1"></a><span class="co"># One sided confidence interval based on normal approx.</span></span>
<span id="cb43-2"><a href="wilcoxon-rank-sum-test.html#cb43-2"></a>mues<span class="op">-</span><span class="kw">qnorm</span>(<span class="fl">0.95</span>)<span class="op">*</span>sdes</span></code></pre></div>
<pre><code>## [1] 950</code></pre>
<p>The value returned for the <span class="math inline">\(p\)</span>-value by <code>wilcox.exact</code> would be roughly twice the one-sided <span class="math inline">\(p\)</span>-value, in this case. The normal approximation is also convenient for obtaining confidence intervals, here [950.06, <span class="math inline">\(\infty\)</span>).</p>
<p>The <code>wilcox.test</code> function returns the so-called Hodges–Lehmann estimator (i.e., the median of all the pairs <span class="math inline">\(Y^{(1)}_i-Y^{(2)}_j\)</span> (<span class="math inline">\(i=1, \ldots, n_1\)</span>; <span class="math inline">\(j=1, \ldots, n_2\)</span>). These point estimators, the associated confidence intervals and the exact coverage of the intervals (with additionally the subtleties surrounging from ties and zeros) are beyond the scope of the course, but <a href="http://www.stat.umn.edu/geyer/5601/examp/ranksum.html">Charles Geyer’s course notes give additional information</a>. The following function is adapted from his code and is distributed under <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a> licence. It can be used to compute the Hodges–Lehmann estimator with the associated confidence interval, while also returning the coverage (not exactly 95% because of the discreteness of the data).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="wilcoxon-rank-sum-test.html#cb45-1"></a><span class="kw">source</span>(<span class="st">&quot;https://lbelzile.bitbucket.io/MATH60619A/hl_wilcox.R&quot;</span>)</span>
<span id="cb45-2"><a href="wilcoxon-rank-sum-test.html#cb45-2"></a>hl &lt;-<span class="st"> </span><span class="kw">hl.wilcox</span>(tickets<span class="op">$</span>offer[tickets<span class="op">$</span>group <span class="op">==</span><span class="st"> &quot;credit&quot;</span>], </span>
<span id="cb45-3"><a href="wilcoxon-rank-sum-test.html#cb45-3"></a>          tickets<span class="op">$</span>offer[tickets<span class="op">$</span>group <span class="op">==</span><span class="st"> &quot;cash&quot;</span>])</span></code></pre></div>
<pre><code>## Wilcoxon rank sum test 
## Hodges-Lehmann estimator:  -12 
## confidence interval:  -20 -4 
## achieved confidence level: 0.95</code></pre>
<p>Another potential nonparametric test is the Fligner–Policello test. Unlike Wilcoxon rank sum, it does not assume that the two distributions are equal under the null hypothesis, but require them to be symmetrical around their median (so the variance in each group could be different). <a href="http://support.sas.com/documentation/cdl/en/statug/67523/HTML/default/viewer.htm#statug_npar1way_details20.htm"><strong>SAS</strong> implements the test and uses the asymptotic normal approximation for <em>p</em> values and such like</a>.</p>
<p>In <strong>R</strong>, the <code>NSM3</code> package provides an implementation of the Fligner–Policello test.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="wilcoxon-rank-sum-test.html#cb47-1"></a>fptest &lt;-<span class="st"> </span>NSM3<span class="op">::</span><span class="kw">pFligPoli</span>(tickets<span class="op">$</span>offer[tickets<span class="op">$</span>group <span class="op">==</span><span class="st"> &quot;credit&quot;</span>], </span>
<span id="cb47-2"><a href="wilcoxon-rank-sum-test.html#cb47-2"></a>          tickets<span class="op">$</span>offer[tickets<span class="op">$</span>group <span class="op">==</span><span class="st"> &quot;cash&quot;</span>])</span>
<span id="cb47-3"><a href="wilcoxon-rank-sum-test.html#cb47-3"></a><span class="dv">1</span><span class="op">-</span>fptest<span class="op">$</span>p.val</span></code></pre></div>
<pre><code>## [1] 0.0014</code></pre>
<p>The estimated <span class="math inline">\(p\)</span>-value for the one-sided test is <span class="math inline">\(0.0017\)</span>.</p>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="two-sample-t-test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Statistical modelling.pdf", "Statistical modelling.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
