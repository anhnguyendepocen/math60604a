<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.2 Exploratory Data Analysis | Statistical Modelling</title>
  <meta name="description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="1.2 Exploratory Data Analysis | Statistical Modelling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  <meta name="github-repo" content="lbelzile/math60604" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.2 Exploratory Data Analysis | Statistical Modelling" />
  
  <meta name="twitter:description" content="This is a web complement to MATH 60604A (Statistical Modelling), a course given in the M.Sc. in management (Data Science and Business Analytics) at HEC Montréal." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tests.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preliminary remarks</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to statistical inference</a></li>
<li class="chapter" data-level="2" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>2</b> Linear regression</a></li>
<li class="chapter" data-level="3" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>3</b> Generalized linear models</a></li>
<li class="chapter" data-level="4" data-path="correlated-longitudinal-data.html"><a href="correlated-longitudinal-data.html"><i class="fa fa-check"></i><b>4</b> Correlated and longitudinal data</a></li>
<li class="chapter" data-level="5" data-path="linear-mixed-models.html"><a href="linear-mixed-models.html"><i class="fa fa-check"></i><b>5</b> Linear mixed models</a></li>
<li class="chapter" data-level="6" data-path="survival.html"><a href="survival.html"><i class="fa fa-check"></i><b>6</b> Survival analysis</a></li>
<li class="chapter" data-level="7" data-path="likelihood.html"><a href="likelihood.html"><i class="fa fa-check"></i><b>7</b> Likelihood-based inference</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li><a href="r.html#r"><strong>R</strong></a></li>
<li class="chapter" data-level="A" data-path="complement.html"><a href="complement.html"><i class="fa fa-check"></i><b>A</b> Mathematical concepts</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="eda" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Exploratory Data Analysis</h2>
<p>Before fitting a model, it is advisable to understand the structure of the data to avoid interpretation errors. Basic knowledge of graphs is required and we will spend some time <a href="https://rstudio.cloud/learn/primers/1.1">addressing this</a>. Further references include</p>
<ul>
<li><a href="https://r4ds.had.co.nz/exploratory-data-analysis.html">Chapter 3, <em><strong>R</strong> for Data Science</em> by Garrett Grolemund and Hadley Wickham</a></li>
<li><a href="https://www.openintro.org/book/isrs/">Section 1.6 of OpenIntro <em>Introductory Statistics with Randomization and Simulation</em></a></li>
<li><a href="https://serialmentor.com/dataviz/"><em>Fundamentals of Data Visualization</em> by Claus O. Wilke</a></li>
<li><a href="https://socviz.co/lookatdata.html#lookatdata">Chapter 1 of <em>Data Visualization: A practical introduction</em> by Kieran Healy</a></li>
</ul>
<p>If exploratory data analysis is often neglected in statistics (perhaps because it has little to no mathematical foundations), it is crucial. More than a rigorous approach, it is an art: Grolemund and Wickham talk of “state of mind”. The purpose of graphical exploratory data analysis is the extraction of useful information, often through a series of preliminary questions that are refined as the analysis progresses. Of particular interest and the relations and interactions between difference variables and the distribution of the variables themselves. The major steps for undertaking an exploratory analysis are:</p>
<ol style="list-style-type: decimal">
<li>Formulate questions about the data</li>
<li>Look for answers using frequency table, descriptive statistics and graphics.</li>
<li>Refine the questions in light of the finding</li>
</ol>
<p>In a report, you should highlight the most import features in a summary so that the reader can grasp your understanding and so that you guide him or her in the interpretation of the data.</p>
<div id="polish-your-work" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Polish your work</h3>
<p>Pay as much attention to figures and tables than to the main text. These should always include a legend that describes and summarize the findings in the graph (so that the latter is standalone), name of variables (including units) on the axes, but also proper formatting so that the labels and numbers are readable (good printing quality, not too small). One picture is worth 1000 words, but make sure the graph tells a coherent story and that it is mentioned in the main text. Also ensure that only the necessary information is displayed: superfluous information (spurious digits, useless summary statistics) should not be presented.</p>
</div>
<div id="variable-type" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Variable type</h3>
<p>The data we will handled are stored in tables or frames. If the data frame is stocked in wide format, each line corresponds to an observation and each column to a variable: the entries of the data base contain the (numeric) values.</p>
<ul>
<li>a <strong>variable</strong> represents a characteristic of the population, for example the sex of an individual, the price of an item, etc.</li>
<li>an <strong>observation</strong> is a set of measures (variables) collected under identical conditions for an individual or at a given time.</li>
</ul>
<p>The choice of statistical model and test depends on the underlying type of the data collected. There are many choices: quantitative (discrete or continuous) if the variables are numeric, or qualitative (binary, nominal, ordinal) if they can be described using an adjective; I prefer the term categorical, which is more evocative.</p>
<!-- ```{r variablesquanti, fig.cap = "Illustration par Allison Horst de variables continues (gauche) et discrètes (droite).", echo = FALSE} -->
<!-- knitr::include_graphics('images/continuous_discrete.png') -->
<!-- ``` -->
<p>Most of the models we will deal with are so-called regression models, in which the mean of a quantitative variable is a function of other variables, termed explanatories. There are two types of numerical variables</p>
<ul>
<li>a discrete variable takes a countable number of values, prime examples being binary variables or count variables.</li>
<li>a continuous variable can take (in theory) an infinite possible number of values, even when measurements are rounded or measured with a limited precision (time, width, mass). In many case, we could also consider discrete variables as continuous if they take enough values (e.g., money).</li>
</ul>
<p>Categorical variables take only a finite of values. They are regrouped in two groups, nominal if there is no ordering between levels (sex, color, country of origin) or ordinal if they are ordered (Likert scale, salary scale) and this ordering should be reflected in graphs or tables. We will bundle every categorical variable using arbitrary encoding for the levels: for modelling, these variables taking <span class="math inline">\(K\)</span> possible values (or levels) must be transformed into a set of <span class="math inline">\(K-1\)</span> binary 0/1 variables, the omitted level corresponding to a baseline. Failing to declare categorical variables in your favorite software is a common mistake, especially when these are saved in the database using integers rather than strings.</p>
<!-- ```{r variablescateg, fig.cap = "Illustration par Allison Horst de variables catégorielles nominales (gauche), ordinales (centre) et binaires (droite).", echo = FALSE} -->
<!-- knitr::include_graphics('images/nominal_ordinal_binary.png') -->
<!-- ``` -->
</div>
<div id="graphs" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Graphs</h3>
<p>The main type of graph for representing categorical variables is bar plot (and modifications thereof). In a bar plot, the frequency of each category is represented in the <span class="math inline">\(y\)</span>-axis as a function of the (ordered) levels on the <span class="math inline">\(x\)</span>-axis. This representation is superior to the <a href="http://www.perceptualedge.com/articles/08-21-07.pdf">ignominious pie chart</a>, a nuisance that ought to be banned (humans are very bad at comparing areas and a simple rotation changes the perception of the graph)!</p>
<div class="figure" style="text-align: center"><span id="fig:barplotrenfe"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/barplotrenfe-1.png" alt="Bar plot of ticket class for Renfe tickets data" width="70%" />
<p class="caption">
Figure 1.6: Bar plot of ticket class for Renfe tickets data
</p>
</div>
<p>Continuous variables can take as many distinct values as there are observations, so we cannot simply count the number of occurences by unique values. Instead, we bin them into distinct intervals so as to obtain an histogram. The number of class depends on the number of observations: as a rule of thumb, the number of bins should not exceed <span class="math inline">\(\sqrt{n}\)</span>, where <span class="math inline">\(n\)</span> is the sample size. We can then obtain the frequency in each class, or else normalize the histogram so that the area under the bands equals one: this yields a discrete approximation of the underlying density function. Varying the number of bins can help us detect patterns (rounding, asymmetry, multimodality).</p>
<p>Since we bin observations together, it is sometimes difficult to see where they fall. Adding rugs below or above the histogram will add observation about the range and values taken, where the heights of the bars in the histogram carry information about the (relative) frequency of the intervals.</p>
<div class="figure" style="text-align: center"><span id="fig:histrenfe"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/histrenfe-1.png" alt="Histogram of Promo tickets for Renfe ticket data" width="70%" />
<p class="caption">
Figure 1.7: Histogram of Promo tickets for Renfe ticket data
</p>
</div>
<p>If we have a lot of data, it sometimes help to focus only on selected summary statistics. A box-and-whiskers plot (or boxplot) represents five numbers</p>
<ul>
<li>The box gives the quartiles <span class="math inline">\(q_1, q_2, q_3\)</span> of the distribution. The middle bar <span class="math inline">\(q_2\)</span> is thus the median, so 50% of the observations are smaller or larger than this number.</li>
<li>The length of the whiskers is up to <span class="math inline">\(1.5\)</span> times the interquartiles range <span class="math inline">\(q_3-q_1\)</span> (the whiskers extend until the latest point in the interval, so the largest observation that is smaller than <span class="math inline">\(q_3+1.5(q_3-q_1)\)</span>, etc.)</li>
<li>Observations beyond the whiskers are represented by dots or circles, sometimes termed outliers. However, beware of this terminology: the larger the sample size, the more values will fall outside the whiskers. This is a drawback of boxplots, which was conceived at a time where the size of data sets was much smaller than what is current standards.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:boxplot"></span>
<img src="images/01-intro-boxplot.png" alt="Box-and-whiskers plot" width="70%" />
<p class="caption">
Figure 1.8: Box-and-whiskers plot
</p>
</div>
<p>We can represent the distribution of a response variable as a function of a categorical variable by drawing a boxplot for each category and laying them side by side. A third variable, categorical, can be added via a color palette, as shown in Figure <a href="eda.html#fig:histboxplot">1.9</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:histboxplot"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/histboxplot-1.png" alt="Box-and-whiskers plots for Promo fare tickets as a function of class and type for the Renfe tickets data." width="70%" />
<p class="caption">
Figure 1.9: Box-and-whiskers plots for Promo fare tickets as a function of class and type for the Renfe tickets data.
</p>
</div>
<p>Scatterplots are used to represent graphically the co-variation between two continuous variables: each tuple gives the coordinate of the point. If only a handful of large values are visible on the graph, a transformation may be useful: oftentimes, you will encounter graphs where the <span class="math inline">\(x\)</span>- or <span class="math inline">\(y\)</span>-axis is on the log-scale when the underlying variable is positive. If the number of data points is too large, it is hard to distinguish points because they are overlaid: adding transparency, or binning using a two-dimensional histogram with the frequency represented using color are potential solutions. The left panel of Figure <a href="eda.html#fig:scatterplot">1.10</a> shows the 100 simulated observations, whereas the right-panel shows a larger sample of 10 000 points using hexagonal binning, an analog of the bivariate density.</p>
<div class="figure" style="text-align: center"><span id="fig:scatterplot"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/scatterplot-1.png" alt="Scatterplot (left) and hexagonal heatmap of bidimensional bin counts (right) of simulated data." width="70%" />
<p class="caption">
Figure 1.10: Scatterplot (left) and hexagonal heatmap of bidimensional bin counts (right) of simulated data.
</p>
</div>
<p>Sometimes, continuous data have a particular structure, mostly when observations are collected over space or time. Time series are ordered and the response should be plotted on the <span class="math inline">\(y\)</span>-axis as a function of time (on the <span class="math inline">\(x\)</span>-axis). It is customary to draw segments between observations, but this display is sometimes misleading.</p>
<div class="figure" style="text-align: center"><span id="fig:seriechrono"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/seriechrono-1.png" alt="Graphical representation of a time series." width="70%" />
<p class="caption">
Figure 1.11: Graphical representation of a time series.
</p>
</div>
</div>
<div id="exploratory-data-analysis" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Exploratory data analysis</h3>
<p>Rather than describe in details the exploratory analysis procedure, we proceed with an example that illustrates the process on the Renfe ticket dataset that was introduced previously.</p>

<div class="example">
<span id="exm:renfe-aed" class="example"><strong>Example 1.3  (Exploratory data analysis of Renfe tickets)  </strong></span>First, read the documentation accompanying the dataset! The data base <code>renfe</code> contains the following variables:
</div>
<ul>
<li><code>price</code> price of the ticket (in euros);</li>
<li><code>dest</code> binary variable indicating the journey, either Barcelona to Madrid (<code>0</code>) or Madrid to Barcelona (<code>1</code>);</li>
<li><code>fare</code> categorical variable indicating the ticket fare, one of <code>AdultoIda</code>, <code>Promo</code> or <code>Flexible</code>;</li>
<li><code>class</code> categorical variable giving the ticket class, either <code>Preferente</code>, <code>Turista</code>, <code>TuristaPlus</code> or <code>TuristaSolo</code>;</li>
<li><code>type</code> categorical variable indicating the type of train, either Alta Velocidad Española (<code>AVE</code>), Alta Velocidad Española jointly with TGV (parternship between SNCF and Renfe for trains to/from Toulouse) <code>AVE-TGV</code> or regional train <code>REXPRESS</code>; only trains labelled <code>AVE</code> or <code>AVE-TGV</code> are high-speed trains.</li>
<li><code>duration</code> length of train journey (in minutes);</li>
<li><code>wday</code> categorical variable (integer) denoting the week day, ranging from Sunday (<code>1</code>) to Saturday (<code>7</code>).</li>
</ul>
<p>There are no missing values and a quick view of the first row of the data frame (<code>head(renfe)</code>) shows that the data are stored in long format, meaning each line corresponds to a different ticket. We will begin our exploratory analysis with vague questions, for example</p>
<ol style="list-style-type: decimal">
<li>What are the factors determining the price and travel time?</li>
<li>Does travel time depend on the type of train?</li>
<li>What are the distinctive features of train types?</li>
<li>What are the main differences between fares?</li>
</ol>
<p>Except for <code>price</code> and <code>duration</code>, all the other (explanatory) variables are categoricals. These need to be cast into factors (<code>factor</code>), especially integer-valued levels such as <code>wday</code>.</p>
<p>The database is clean and this preliminary preprocessing step has been done already. We can check the type of encoding using the command <code>str</code>, which also shows the data; the function <code>summary</code> is used to obtain descriptive statistics (min, max, mean, quartiles for continuous variables or else frequency for categorical variables); the function also returns the number of missing values (<code>NA</code>) of each column.</p>
<p>Data manipulation is often messy and <strong>R</strong> base syntax is particularly inelegant: data frames are list whose elements are accessed using <code>$</code>: for example <code>renfe$price</code>. A more legible and modular alternative is the pipe operator (<code>%&gt;%</code>), with which one creates a logical chain of command (this function is not part of <strong>R</strong> base packages, but the libraries <code>tidyverse</code> and the minimal alternative <code>poorman</code> include it).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="eda.html#cb6-1" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(class)</span></code></pre></div>
<pre><code>##         class    n
## 1  Preferente  809
## 2     Turista 7197
## 3 TuristaPlus 1916
## 4 TuristaSolo   78</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="eda.html#cb8-1" aria-hidden="true"></a><span class="co"># `count` is a shortcut for the following syntax</span></span>
<span id="cb8-2"><a href="eda.html#cb8-2" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</span></code></pre></div>
<pre><code>##       type    n
## 1      AVE 9174
## 2  AVE-TGV  429
## 3 REXPRESS  397</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="eda.html#cb10-1" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(fare) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</span></code></pre></div>
<pre><code>##        fare    n
## 1 AdultoIda  397
## 2  Flexible 1544
## 3     Promo 8059</code></pre>
<p>By counting the number of train tickets in each category, we notice there are as many <code>REXPRESS</code> tickets as there are tickets sold at <code>AdultoIda</code> fare. Using a contingency table to get the number in respective sub-categories of each of those variables confirms that all tickets in the database for RegioExpress trains are sold with the <code>AdultoIda</code> fare and that there is only a single class, <code>Turista</code>. There are few such tickets, only 397 out of 10 000. This raises a new question: why are such trains so unpopular?</p>
<pre><code>##        fare     type    n
## 1 AdultoIda REXPRESS  397
## 2  Flexible      AVE 1446
## 3  Flexible  AVE-TGV   98
## 4     Promo      AVE 7728
## 5     Promo  AVE-TGV  331</code></pre>
<p>We have only scratched the surface, but one could also notice that there are only 17 duration values on tickets (<code>renfe %&gt;% distinct(duration)</code> or <code>unique(renfe$duration)</code>). This leads us to think the duration on the ticket (in minutes) is the expected travel time. The majority of those travel time (15 out of 17) are smaller than 3h15, but the other two exceed 9h! Looking at Google Maps, Madrid and Barcelona are 615km apart by car, 500km as the crow flies. this means some trains travel at about 200km/h, while others are closer to 70km/h. What are these slower trains? the variable <code>type</code> is the one most likely to encode this feature, and a quick look shows that the RegioExpress trains fall in the slow category (mystery solved!)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="eda.html#cb13-1" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="eda.html#cb13-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">subset</span>(duration <span class="op">&gt;</span><span class="st"> </span><span class="dv">200</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="eda.html#cb13-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(type, dest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-4"><a href="eda.html#cb13-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="st">&quot;average duration&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(duration), </span>
<span id="cb13-5"><a href="eda.html#cb13-5" aria-hidden="true"></a>            <span class="st">&quot;std. dev&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(duration),</span>
<span id="cb13-6"><a href="eda.html#cb13-6" aria-hidden="true"></a>            <span class="st">&quot;average price&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(price), </span>
<span id="cb13-7"><a href="eda.html#cb13-7" aria-hidden="true"></a>            <span class="st">&quot;std. dev&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(price)) </span></code></pre></div>
<pre><code>##       type             dest average duration std. dev average price std. dev
## 1 REXPRESS Barcelona-Madrid              544        0          43.2        0
## 2 REXPRESS Madrid-Barcelona              562        0          43.2        0</code></pre>
<p>The regular trains running between two cities take more than 9h, but one way (Madrid to Barcelona) is 18 minutes slower than in the other direction. More striking, we see that the price of the RegioExpress tickets is fixed: 43.25 euros regardless of direction. This is the most important finding so far, because these are not a sample for price: there is no variability! Graphics could have lead to the discovery (the boxplot of price as a function of train type would collapse to a single value).</p>
<div class="figure" style="text-align: center"><span id="fig:renfe-aed4"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/renfe-aed4-1.png" alt="Boxplot of ticket price as a function of destination and train type." width="70%" />
<p class="caption">
Figure 1.12: Boxplot of ticket price as a function of destination and train type.
</p>
</div>
<p>We could have suspected that trains labeled <code>AVE</code> are faster: after all, it is the acronym of <em>Alta Velocidad Española</em>, literally Spanish high speed. What is the distinction between the two high speed train types. According to the <a href="https://www.renfe-sncf.com/rw-en/services/a-unique-experience/Pages/services.aspx">SNCF website</a>, AVE-TGV trains are partnership between Renfe and SNCF that operate between France and Spain.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="eda.html#cb15-1" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-2"><a href="eda.html#cb15-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">subset</span>(type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AVE&quot;</span>,<span class="st">&quot;AVE-TGV&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-3"><a href="eda.html#cb15-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(type, dest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-4"><a href="eda.html#cb15-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="st">&quot;average duration&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(duration), </span>
<span id="cb15-5"><a href="eda.html#cb15-5" aria-hidden="true"></a>            <span class="st">&quot;std. dev&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(duration),</span>
<span id="cb15-6"><a href="eda.html#cb15-6" aria-hidden="true"></a>            <span class="st">&quot;average price&quot;</span> =<span class="st"> </span><span class="kw">mean</span>(price),</span>
<span id="cb15-7"><a href="eda.html#cb15-7" aria-hidden="true"></a>            <span class="st">&quot;std. dev&quot;</span> =<span class="st"> </span><span class="kw">sd</span>(price))</span></code></pre></div>
<pre><code>##      type             dest average duration std. dev average price std. dev
## 1     AVE Barcelona-Madrid              171     15.9          87.4     19.8
## 2     AVE Madrid-Barcelona              170     16.6          88.2     20.8
## 3 AVE-TGV Barcelona-Madrid              175      0.0          87.0     16.8
## 4 AVE-TGV Madrid-Barcelona              179      0.0          90.6     20.2</code></pre>
<p>The price of high speed trains are on average more than twice as expensive as regular trains. There is strong evidence of heterogeneity (standard deviation of 20 euros), which should raise scrutiny and suggests that high speed train tickets are dynamically priced. There is a single duration time for AVE-TGV tickets. We do not see meaningful differences in price depending on the type or the direction, but fares of ticket class availability may differ depending on whether the train is run in partnership with SNCF.</p>
<p>We have not looked at ticket fare and class, except for RegioExpress trains. Figure <a href="eda.html#fig:renfe-aed7">1.14</a> shows large disparity in the variance of price according to fare: Promo fare takes many more distinct values than AdultoIda (duh) and Flexible fares. First class tickets (<code>Preferente</code>) are more expensive, but there are fewer observations falling in this group. Turista class is the least expensive for high-speed trains and the most popular. <a href="http://web.archive.org/web/20161111134241/http://www.renfe.com/viajeros/tarifas/billete_promo.html"><code>TuristaPlus</code></a> offer an alternative to the latter with more comfort, whereas <code>TuristaSolo</code> gives access to individual seats.</p>
<p>Fare-wise <a href="http://web.archive.org/web/20161111134241/http://www.renfe.com/viajeros/tarifas/billete_promo.html">Promo</a> and <a href="http://web.archive.org/web/20161110220249/http://www.renfe.com/viajeros/tarifas/billete_promoplus.html">PromoPlus</a> give access to rebates that can go up to 70% and 65%, respectively. Promo tickets cannot be cancelled or exchanged, while both are possible with PromoPlus by paying a penalty amounting to 30-20% of the ticket price. <a href="http://web.archive.org/web/20161108192609/http://www.renfe.com/viajeros/tarifas/billete_flexible.html">Flexible</a> fare ticket a sold at the same price as regular high-speed train tickets, but offer additional benefits (and no rebates!)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="eda.html#cb17-1" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">subset</span>(fare  <span class="op">!=</span><span class="st"> &quot;AdultoIda&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="eda.html#cb17-2" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> price, <span class="dt">x =</span> class, <span class="dt">col =</span> fare)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-3"><a href="eda.html#cb17-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-4"><a href="eda.html#cb17-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;price (in euros)&quot;</span>,</span>
<span id="cb17-5"><a href="eda.html#cb17-5" aria-hidden="true"></a>       <span class="dt">x =</span> <span class="st">&quot;class&quot;</span>,</span>
<span id="cb17-6"><a href="eda.html#cb17-6" aria-hidden="true"></a>       <span class="dt">color =</span> <span class="st">&quot;fare&quot;</span>) <span class="op">+</span></span>
<span id="cb17-7"><a href="eda.html#cb17-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:renfe-aed6"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/renfe-aed6-1.png" alt="Boxplot of ticket price as a function of fare and class for high-speed Renfe trains." width="70%" />
<p class="caption">
Figure 1.13: Boxplot of ticket price as a function of fare and class for high-speed Renfe trains.
</p>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="eda.html#cb18-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> renfe, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y=</span>..density.., <span class="dt">fill =</span> fare)) <span class="op">+</span></span>
<span id="cb18-2"><a href="eda.html#cb18-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb18-3"><a href="eda.html#cb18-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;price (in euros)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;density&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb18-4"><a href="eda.html#cb18-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:renfe-aed7"></span>
<img src="MATH60604A_Statistical_modelling_files/figure-html/renfe-aed7-1.png" alt="Histograms of ticket price as a function of fare for Renfe trains." width="70%" />
<p class="caption">
Figure 1.14: Histograms of ticket price as a function of fare for Renfe trains.
</p>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="eda.html#cb19-1" aria-hidden="true"></a><span class="co"># Check the spread of Flexible tickets</span></span>
<span id="cb19-2"><a href="eda.html#cb19-2" aria-hidden="true"></a>renfe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">subset</span>(fare  <span class="op">==</span><span class="st"> &quot;Flexible&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(price, class)</span></code></pre></div>
<pre><code>##   price       class    n
## 1   108     Turista 1050
## 2   108 TuristaSolo   67
## 3   127     Turista  285
## 4   127 TuristaSolo    9
## 5   129 TuristaPlus   31
## 6   140  Preferente    2
## 7   152 TuristaPlus   10
## 8   182  Preferente   78
## 9   214  Preferente   12</code></pre>
<p>Note how Flexible tickets prices are spread: the boxplot is crushed and the interquartile range seems zero, even if some of the values are larger: this is indicative either constant price or of (too few) tickets in the category. We can find out which of these two possibities is most likely by counting the number of Flexible fare tickets for the different types.</p>
<p>Neither duration, nor type or destination explains why some Flexible tickets are more or less expensive than the average. Promo tickets, on the other hand, are cheaper on average and Preferente more expensive.</p>
<p>We can summarize our findings:</p>
<ul>
<li>more than 91% of trains are high-speed trains.</li>
<li>travel time depends on the type of train: high-speed train take at most 3h20.</li>
<li>duration records expected travel time: there are only 17 unique values, 13 of which are for AVE trains.</li>
<li>the price of RegioExpress train ticket is fixed (43.25€); all such tickets are sold with AdultoIda fare and there only one class (Turista). 57% of these trains go from Barcelona to Madrid and travel time is 9h22 from Barcelona to Madrid, 9h04 in the other direction.</li>
<li><code>Turista</code> is the cheapest and most popular class. <code>Preferente</code> class tickets are more expensive and are less often sold. <code>TuristaPlus</code> offers more comfort and <code>TuristaSolo</code> let you get individual seats.</li>
<li>according to the <a href="https://www.renfe.com/es/es/viajar/tarifas/billetes.html">Renfe website</a>, <code>Flexible</code> fare tickets “come with additional offers and passengers can exchange or cancel their tickets if they miss their train”; as a counterpart, these tickets are more expensive and most tickets have a fixed fare (a handful are cheaper or more expensive, but this price difference is unexplained).</li>
<li>the distribution of <code>Promo</code> fare high-speed trains ticket prices are more or less symmetric, but <code>Flexible</code> tickets seem left-truncated (the minimum price for these tickets in the sample is 107.7€).</li>
<li>it appears that tickets sold by Renfe (<code>Promo</code> fare) are dynamically priced: the latter can be up to 70% cheaper than regular high-speed train tickets when purchased through the official agency or Renfe’s website. These tickets cannot be refunded or exchanged.</li>
<li>there is no indication that prices depend on the direction of travel.</li>
</ul>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="tests.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MATH60604A_Statistical_modelling.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
